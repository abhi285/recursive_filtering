# models/semantic/metrics.yml
metrics:
  - name: hierarchical_revenue
    description: "Revenue with recursive filtering applied based on dbt variables."
    type: simple
    type_params:
      measure: total_revenue
    filter: |
      {{ recursive_hierarchy_filter(
          hierarchy='organizational_hierarchy',
          level=var('filter_level'),
          value=var('filter_value')
        )
      }}

  - name: brand_performance_cascade
    description: "Brand performance including all child entities. Assumes filter_level='brand' and filter_value is set."
    type: derived
    type_params:
      expr: 'total_revenue / nullif(guest_count, 0)'
    filter: |
      {{ recursive_hierarchy_filter(
          hierarchy='organizational_hierarchy',
          level='brand', -- Explicitly set for this metric's purpose
          value=var('filter_value') -- Will use the global filter_value
        )
      }}